# ConcurrentHashMap 

## 底层数据结构

- 数组+链表，当冲突链表达到一定长度时，链表会转为红黑树

![](_v_images/20210413140124864_7289.png =981x)

## 确保线程安全的方式

- CAS
- synchronized锁链表表头或红黑树根节点

## put方法逻辑

- 根据 key 计算出 hashcode
- 判断是否需要进行初始化
- 即为当前 key 定位出的 Node，如果为空表示当前位置可以写入数据，利用 CAS 尝试写入，失败则自旋保证成功
- 如果当前位置的 hashcode == MOVED == -1,则需要进行扩容
- 如果都不满足，则利用 synchronized 锁写入数据
- 如果数量大于8则要转换为红黑树
